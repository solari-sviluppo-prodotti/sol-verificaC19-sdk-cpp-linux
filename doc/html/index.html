<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sol-verificaC19-sdk-cpp-linux: sol-verificaC19-cpp-linux</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sol-verificaC19-sdk-cpp-linux
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">sol-verificaC19-cpp-linux </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<h2><a class="anchor" id="autotoc_md1"></a>
C++ library for decoding and validate the European Digital Green Certificate</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Summary</h3>
<p>The library allows to decode and validate any EU Digital Green Certificate, providing interfaces to easily implement specific providers for every country's backend.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Dependencies</h3>
<p>The following dependencies are used in the project by the verifier SDK:</p><ul>
<li><b><a href="https://github.com/madler/zlib">zlib</a> 1.2.11.</b> Zlib is a general-purpose, patent-free, lossless data compression library which is used by many different programs.</li>
<li><b><a href="https://github.com/jimsch/cn-cbor">cn-cbor</a> 1.0.0.</b> A constrained node implementation of CBOR in C.</li>
<li><b><a href="https://github.com/openssl/openssl">libcrypto</a> at least 1.0.2j.</b> OpenSSL is a robust, commercial-grade, full-featured Open Source Toolkit for the Transport Layer Security (TLS) protocol formerly known as the Secure Sockets Layer (SSL) protocol.</li>
</ul>
<p>The following dependencies are used in the project by the examples:</p><ul>
<li><b><a href="https://github.com/curl/curl">libcurl</a> at least 7.61.0.</b> Library for transferring data specified with URL syntax.</li>
<li><b><a href="https://github.com/open-source-parsers/jsoncpp">jsoncpp</a> at least 1.8.4.</b> JSON is a lightweight data-interchange format. It can represent numbers, strings, ordered sequences of values, and collections of name/value pairs.</li>
</ul>
<h3><a class="anchor" id="autotoc_md4"></a>
Build</h3>
<p>Once cloned, to build on your system you can use this command, will compile and install libverificaC19-sdk.so:</p>
<div class="fragment"><div class="line">cmake .</div>
<div class="line">make</div>
<div class="line">make install # as root or sudoer</div>
</div><!-- fragment --><p>If you want to build also with examples and create also examples library you can use this command, will compile and install libverificaC19-sdk.so and libverificaC19-common-examples.so:</p>
<div class="fragment"><div class="line">cmake . -DBUILD_EXAMPLES=ON</div>
<div class="line">make</div>
<div class="line">make install # as root or sudoer</div>
</div><!-- fragment --><p>If you want to build static libraries (with or without examples) you can use this command, will compile and install libverificaC19-sdk.a and (if enabled) libverificaC19-common-examples.a:</p>
<div class="fragment"><div class="line">cmake . -DBUILD_STATIC=ON</div>
<div class="line">make</div>
<div class="line">make install # as root or sudoer</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
Tested architectures</h3>
<p>This SDK has been tested in these architectures:</p><ul>
<li>x86-64</li>
<li>ARM v4T</li>
<li>ARM v7</li>
</ul>
<h3><a class="anchor" id="autotoc_md6"></a>
Usage</h3>
<p>The main entry point of the library is the <code>DGCVerifier</code> class.</p>
<p>This class needs a implementation of IKeysStorage, IRulesStorage and ICRLStorage interfaces to access to storage.</p>
<p>Optionally you can use a implementation of ILogger interface to log operations.</p>
<p>You can simply instantiate and configure it:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/keys-storage/KeysStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/rules-storage/RulesStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/crl-storage/CRLStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/loggers/LoggerStdout.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/DGCVerifier.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line">LoggerStdout logger(DEBUG);</div>
<div class="line">KeysStorageFile keysStorage;</div>
<div class="line">RulesStorageFile rulesStorage;</div>
<div class="line">CRLStorageFile crlStorage;</div>
<div class="line"> </div>
<div class="line">DGCVerifier verifier(&amp;keysStorage, &amp;rulesStorage, &amp;crlStorage, &amp;logger);</div>
</div><!-- fragment --><p>Once instantiated and configured with storage services, you can simply use it calling the following methods:</p>
<div class="fragment"><div class="line">...</div>
<div class="line">if (!verifier.verifyMinSdkVersion()) {</div>
<div class="line">  logger.error(<span class="stringliteral">&quot;Minimum SDK version does not match&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Setup scan mode</span></div>
<div class="line">verifier.setScanMode(SCAN_MODE_2G);</div>
<div class="line"> </div>
<div class="line">std::string qrCode = <span class="stringliteral">&quot;Raw qr code data starting with HC1:&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Decode and validate the qr code data.</span></div>
<div class="line"><span class="comment">// The result will contain all the details of the validated object</span></div>
<div class="line">CertificateSimple result = verifier.verify(qrCode);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> CertificateStatus status = result.certificateStatus;</div>
<div class="line">...</div>
</div><!-- fragment --><p>The rules, keys and CRL updater process is managed by th <code>DGCUpdater</code> class.</p>
<p>This class needs a implementation of IKeysStorage, IRulesStorage and ICRLStorage interfaces to access to storage and IKeysProvider, IRulesProvider and ICRLProvider interfaces to access to providers.</p>
<p>Optionally you can use a implementation of ILogger interface to log operations.</p>
<p>You can simply instantiate and configure it:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/keys-storage/KeysStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/keys-provider/KeysProviderItaly.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/rules-storage/RulesStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/rules-provider/RulesProviderItaly.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/crl-storage/CRLStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/crl-provider/CRLProviderItaly.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/loggers/LoggerStdout.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/DGCUpdater.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line">LoggerStdout logger(DEBUG);</div>
<div class="line">KeysStorageFile keysStorage;</div>
<div class="line">RulesStorageFile rulesStorage;</div>
<div class="line">CRLStorageFile crlStorage;</div>
<div class="line">KeysProviderItaly keysProvider(&amp;logger);</div>
<div class="line">RulesProviderItaly rulesProvider(&amp;logger);</div>
<div class="line">CRLProviderItaly crlProvider(&amp;logger);</div>
<div class="line"> </div>
<div class="line">DGCUpdater updater(86400, &amp;rulesProvider, &amp;rulesStorage,</div>
<div class="line">        &amp;keysProvider, &amp;keysStorage, &amp;crlProvider, &amp;crlStorage, &amp;logger);</div>
</div><!-- fragment --><p>so the complete example with rules and keys update and DGC verify is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/keys-storage/KeysStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/keys-provider/KeysProviderItaly.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/rules-storage/RulesStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/rules-provider/RulesProviderItaly.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/crl-storage/CRLStorageFile.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/crl-provider/CRLProviderItaly.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/examples/loggers/LoggerStdout.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/DGCVerifier.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;verificaC19-sdk/DGCRulesKeysUpdater.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialization (at startup)</span></div>
<div class="line"> </div>
<div class="line">LoggerStdout logger(DEBUG);</div>
<div class="line">KeysStorageFile keysStorage;</div>
<div class="line">RulesStorageFile rulesStorage;</div>
<div class="line">CRLStorageFile crlStorage;</div>
<div class="line">KeysProviderItaly keysProvider(&amp;logger);</div>
<div class="line">RulesProviderItaly rulesProvider(&amp;logger);</div>
<div class="line">CRLProviderItaly crlProvider(&amp;logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This automatically updates rules, keys and CRL every 86400 seconds</span></div>
<div class="line">DGCUpdater updater(86400, &amp;rulesProvider, &amp;rulesStorage,</div>
<div class="line">        &amp;keysProvider, &amp;keysStorage, &amp;crlProvider, &amp;crlStorage, &amp;logger);</div>
<div class="line"> </div>
<div class="line">DGCVerifier verifier(&amp;keysStorage, &amp;rulesStorage, &amp;crlStorage, &amp;logger);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// At startup wait to have a valid set of rules and keys, if this is</span></div>
<div class="line"><span class="comment">// first application launch the storage cuold be empty</span></div>
<div class="line"><span class="keywordflow">if</span> (!updater.isUpdated()) {</div>
<div class="line">    <span class="comment">// Signal to user that rules and keys is updating</span></div>
<div class="line">    <span class="keywordflow">while</span> (!updater.isUpdated()) {</div>
<div class="line">        usleep(10000);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Signal to user that rules, keys and CRL was updated</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Usage (for every read Digital Certificate)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!verifier.verifyMinSdkVersion()) {</div>
<div class="line">  logger.error(<span class="stringliteral">&quot;Minimum SDK version does not match&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Setup scan mode</span></div>
<div class="line">verifier.setScanMode(SCAN_MODE_2G);</div>
<div class="line"> </div>
<div class="line">std::string qrCode = <span class="stringliteral">&quot;Raw qr code data starting with HC1:&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Decode and validate the qr code data.</span></div>
<div class="line"><span class="comment">// The result will contain all the details of the validated object</span></div>
<div class="line">CertificateSimple result = verifier.verify(qrCode);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> CertificateStatus status = result.certificateStatus;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Rules, Keys and CRL storage</h3>
<p>Rules, Keys and CRL storage are mandatory services and must be implemented using IRulesStorage, IKeysStorage and ICRLStorage interfaces.</p>
<p>SDK provide:</p><ul>
<li>full working example implementations to store Rules, Keys and CRL in memory, (<code><a class="el" href="RulesStorageMemory_8hpp_source.html">examples/rules-storage/RulesStorageMemory.hpp</a> /.cpp</code> and <code><a class="el" href="KeysStorageMemory_8hpp_source.html">examples/keys-storage/KeysStorageMemory.hpp</a> /.cpp</code> and <code><a class="el" href="CRLStorageMemory_8hpp_source.html">examples/crl-storage/CRLStorageMemory.hpp</a> /.cpp</code>)</li>
<li>full working example implementations to store Rules, Keys and CRL in json File, (<code><a class="el" href="RulesStorageFile_8hpp_source.html">examples/rules-storage/RulesStorageFile.hpp</a> /.cpp</code> and <code><a class="el" href="KeysStorageFile_8hpp_source.html">examples/keys-storage/KeysStorageFile.hpp</a> /.cpp</code> and <code><a class="el" href="CRLStorageFile_8hpp_source.html">examples/crl-storage/CRLStorageFile.hpp</a> /.cpp</code>)</li>
</ul>
<p>but you can implement your storage in File or in Database.</p>
<p>Interfaces declare methods to:</p><ul>
<li>store Rule, Key or CRL without transaction</li>
<li>store Rules, Keys or CRL in transaction, to use "old" Rules, Keys or CRL until update is done</li>
<li>get info about Rules, Keys or CRL update in progress</li>
<li>get info about Rules, Keys or CRL last update time</li>
<li>get info about last Key token stored</li>
</ul>
<h3><a class="anchor" id="autotoc_md8"></a>
Rules, Keys and CRL provider</h3>
<p>Rules, Keys and CRL update provider are an optional services used to update Rules, Keys and CRL and can be implemented using IRulesProvider, IKeysProbider, ICRLProvider or IAllProvider interfaces.</p>
<p>SDK provide full working example implementations to update Rules, Keys and CRL from Italian provider, (<code><a class="el" href="RulesProviderItaly_8hpp_source.html">examples/rules-provider/RulesProviderItaly.hpp</a> /.cpp</code> and <code><a class="el" href="KeysProviderItaly_8hpp_source.html">examples/keys-provider/KeysProviderItaly.hpp</a> /.cpp</code> and <code><a class="el" href="CRLProviderItaly_8hpp_source.html">examples/crl-provider/CRLProviderItaly.hpp</a> /.cpp</code>) but you can implement provider to get Rules, Keys or CRL from other states or by your custom provider.</p>
<p>Interfaces declare methods to refresh Rules, Keys, CRL or All (IAllProvider).</p>
<p>Interface methods request instance of Rules, Keys or CRL storage interface as described above.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Logger</h3>
<p>SDK contemplate use of logger with interface ILogger, but you can easily set a NULL pointer to this to not have log or implement you logger.</p>
<p>SDK provide example implementation of standard output logger (<code><a class="el" href="LoggerStdout_8hpp_source.html">examples/loggers/LoggerStdout.hpp</a> / .cpp</code>).</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Application examples</h2>
<p>SDK provides also example of C++ (<code>examples/verificaC19-sdk-example.cpp</code>) and C (<code>examples/c/verificaC19-sdk-example.c</code>) applications.</p>
<p>SDK provides also simple client of C++ (<code>examples/verificaC19-sdk-client.cpp</code>) and C (<code>examples/c/verificaC19-sdk-client.c</code>) applications.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Disclaimer</h3>
<p>This library is <b>not</b> an official implementation, therefore its use may be subject to restrictions by some countries regulations. The author assumes no responsibility for any unauthorized use of the library and no warranties about the correctness of the implementation, as better stated in the License.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Licensing</h3>
<p>Licensed under the <b>Apache License, Version 2.0</b> (the "License"); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at <a href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a>.</p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the <a href="./LICENSE">LICENSE</a> for the specific language governing permissions and limitations under the License. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
